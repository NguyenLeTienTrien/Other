
// *************** MAIN.C **********************

#include"include.h"

int main(int argc, char const *argv[])
{
    system("clear");

    // Print Banner
    printf("\t<==================================>\n");
    printf("\t ||\t\t\t\t ||\n");
    printf("\t ||    TRO CHOI NGUOI TREO CO\t ||\n");
    printf("\t ||\t\t\t\t ||\n");
    printf("\t<==================================>\n");
    printf("\n\n");

    char * word = randomWord("folder/word");
    
    // Show the word for... when you want fix some stuff~
        printf("\n\nWord: %s\n\n", word);
    // ^~~ Remember hide it when you play game!!!
    
    int size = countChar(word);     // you can use strlen() !
    char * hiddenWord = hide(size);
    int countTrue = 0;
    int hp = 10;

    // Get from PLAYER and Check and Return!
    while (countTrue != size)
    {
        printGame(hiddenWord, hp);
        checkChar(word, hiddenWord, size, &countTrue, &hp, inputChar());
        if (hp == 0)
        {
            // YOU LOSE !!!
            printf("\a\n\t\tGAME OVER!!!\n");
            exit(0);
        }
    }
    
    // If you WINNNN !!!
    printf("\a\n\n***********************!!! XIN CHUC MUNG !!!***********************\n=> TU BI MAT LA:  %s\n\n*******************************************************************\n", word);

    // free the variable! DON'T FORGET !!
    free(hiddenWord);

    return 0;
}
// END.









// ************ FUNC.C **************

#include"include.h"

char *randomWord(const char *fileLocation)
{
    srand(time(NULL));
    static char randomWord[100];
    FILE *file = NULL;
    file = fopen(fileLocation, "r");
    if (file != NULL)
    {
        int lineNum[100] = {0};
        int i = 0;
        int j = 1;
        char curChar = 0;

        // MAKE INDEX "LINE_NUMBER"
        for ( i = 0; curChar != EOF; i++)
        {
            curChar = fgetc(file);
            if (curChar == '\n')
            {
                lineNum[j] = i+1;
                j++;
            }
        }
        j--;

        // RANDOM WORD FROM FILE BY INDEX
        fseek(file, lineNum[rand()%j], SEEK_SET);
        fgets(randomWord, 100, file);

        // CONVERT '\n' TO '\0'
        for (int i = 0; randomWord[i] != '\0'; i++)
        {
            if (randomWord[i] == '\n')
            {
                randomWord[i] = '\0';
            }
        }

        // CLOSE FILE
        fclose(file);
    }

    // CAN'T OPEN FILE !
    else
    {
        printf("\a\n<!> ERROR: CAN'T OPEN FILE! <!> \n");
        exit(1);
    }
    return randomWord;
}

int countChar(const char *word)
{
    int i=0;
    for (i = 0; word[i] != '\0'; i++);
    return i;
}

char * hide(int size)
{
    int i=0;
    char * hide = NULL;
    hide = (char*)malloc(size + 1);
    if (hide == NULL)
    {
    	printf("\a\n<!> ERROR WITH MEMORY! <!>\n");
        exit(1);
    }
    
    for (i = 0; i < size; i++)
    {
        hide[i] = '*';
    }
    hide[i] = '\0';
    return hide;
}

char inputChar()
{
    char inputchar= 0;
    inputchar = getchar ();
    inputchar = toupper (inputchar);
    while (getchar() != '\n');
    return inputchar;
}

void checkChar(const char *word, char *hiddenWord, int size, int *countTrue, int *hp, char inputChar)
{
    Bool tmp = False;
    for (int i = 0; i < size; i++)
    {
        if (inputChar == word[i])
        {
            // Check Char if it input again!
            if (inputChar == hiddenWord[i])
            {
                tmp = False;
                break;
            }
            // Check and replace the same Char
            else
            {
                hiddenWord[i] = word[i];
                *countTrue = *countTrue + 1;
                tmp = True;
            }
        }
    }
    // -1 HP if incorrect
    if (tmp == False)
    {
        *hp = *hp - 1;
    }
}

void printGame(char * hiddenWord, int hp)
{
    printf("\n\nBan con %d luot doan.\n", hp);
    printf("Tu bi an la gi? %s\n", hiddenWord);
    printf("Hay doan mot chu cai: ");
}







// **************** INCLUDE.H *******************

#ifndef LIB_HANGMAN 
#define LIB_HANGMAN

#include<stdlib.h>
#include<stdio.h>
#include<ctype.h>
#include<curses.h>
#include<time.h>


typedef enum Bool { True, False } Bool;
char * hide(int size);
char inputChar();
void checkChar(const char *Word, char *hiddenWord, int size, int *countTrue, int *hp, char inputChar);
int countChar(const char *word);
void printGame(char *hiddenWord, int hp);
char *randomWord(const char *fileLocation);

#endif
